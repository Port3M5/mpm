#!/usr/bin/env ruby

require 'rubygems'
require 'bundler/setup'

require 'trollop'
require_relative '../config'
require_relative '../packagemanager'

# Configure Trollop for ARGs
SUB_COMMANDS = %w(use list new setup current)
global_opts = Trollop::options do
  banner "Minecraft Profile Manager. Minecraft management made easy :)"
  version "0.2"
  opt :config, "Use config file from this location", :type => String
  opt :storage, "Select the location to store the mpm folder", :type => String
  stop_on SUB_COMMANDS
end

# Load the configs up
@config = MPMConfig.new global_opts
@pm = MPMPackageManager.new @config.options

## Define the functions

# Gets all the packages
def list
  puts @pm
end

def use name
  @pm.use name
end

def create_new name, use
  @pm.create_new name, use
end

# Get the subcommands
cmd = ARGV.shift
cmd_opts = case cmd
when "setup"
when "list"
when "use"
when "new"
  Trollop::options do
    opt :use, "Uses the newly created profile", :default => false
  end
else
  Trollop::die "Unknown subcommand"
end

# Run the commands
case cmd
when "setup"
  @pm.setup
when "list"
  list
when "use"
  use ARGV.first
when "new"
  create_new ARGV.first, cmd_opts[:use]
when "current"
  puts "Current Profile is: #{@pm.get_current_package}"
end